# coding:utf-8

import urllib2
import json
from validate_email import validate_email

DEBUG = True
API_REG_WEB_LIST = 'http://m.wuzei.org/appapi/json/ScanRegWebList.json?keyWord={0}'
if DEBUG:
    API_LEAK_QUERY = 'http://leakquery.proxy.fraudmetrix.cn/leakQuery.json?key_word={0}'
else:
    API_LEAK_QUERY = 'http://192.168.47.63:8080/leakQuery.json?key_word={0}'


class MailChecker(object):

    def __init__(self, email, providers):
        self.email = email
        self.email_prefix = email.split('@')[0]
        self.email_postfix = email.split('@')[1]
        self.providers = providers

    def is_temp(self):
        if self.email_postfix in self.providers:
            return True
        return False

    def is_real(self):
        return validate_email(self.email, verify=True)

    def check_leak(self):
        return len(self._query_tongdun_api(API_LEAK_QUERY.format(self.email)))

    def check_reg_web(self):
        return len(self._query_tongdun_api(API_REG_WEB_LIST.format(self.email)))

    def _query_tongdun_api(self, api):
        u = urllib2.urlopen(api)
        jsonstr = u.read()
        u.close()
        result = json.loads(jsonstr)
        return result.get('result', '')
